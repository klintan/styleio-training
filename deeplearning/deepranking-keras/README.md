#Supervised Image Similarity (Deep Rank)

Deep Rank is a neural network that transforms the feature space of the images into another that is optimal for image similarity. The first step to train the neural is to generate a database of similar images:

A reference image H
An image H+ similar to H
An image H- similar to H but not as similar as H+
Ideally, the training set should be one in which generate a wrong ordering when using an unsupervised approach: HxH+ < HxH-. The neural network NN should be one that generates a correct ordering: NN(H)xNN(H+) > NN(H)xNN(H-)

The first step is to generate database by using the Similarity Editor. The H (reference) image is the one in the top-center of the screen ('Image To Search'). Below there is a list of images. The user should first click on the image that will represent H+ which will be framed in blue. Afterwards the user should click on the image that will be H- which will be framed in red.

Once the database is generated the next step is to generate a training and a test set to train the neural network. That is done automatically in TiefVision using the image similarity train and test generator endpoint.

The next step is to train the neural network using a Hing loss criterion:

cd $TIEFVISION_HOME/src/torch/13-deeprank-train
luajit deeprank-train.lua
Finally it's necessary to do the same encoding and database generation procedure done for the unsupervised case in order to use it in the search engine.

Encoding of the images into the new space generated by the trained neural network
cd $TIEFVISION_HOME/src/torch/14-deeprank-encoding
luajit deeprank-encoding.lua
Generate database of similarity between each pair of images in the master folder
cd $TIEFVISION_HOME/src/torch/15-deeprank-db
luajit deeprank-db.lua
Once the database is generated, the images in master can be searched using that database using:

cd $TIEFVISION_HOME/src/torch/15-deeprank-searcher-db
luajit search.lua -image <IMAGE_NAME_OF_AN_IMAGE_IN_$TIEFVISION_HOME/resources/dresses-db/master>